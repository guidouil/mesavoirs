<template name='place'>

    {{#with place}}
    {{#if isSellerOrOwner}}
    <div class="ui basic segment">
      {{#if isOwner}}
        <a href="{{pathFor 'placeEdit' placeId=_id}}" class="teal right floated ui circular icon button"><i class="pencil icon"></i></a>
        <div class="ui slider checkbox">
          <input type="checkbox" name="enabled" checked="{{enabled}}" data-action="enablePlace">
          <label>Commerce {{#unless enabled}}in{{/unless}}actif</label>
        </div>
        <br>
        <br>
      {{/if}}
      <br>
      <div class="ui grid">
        <div class="height wide column">
          <button type="button" class="ui {{#if currentPlace}}green{{/if}} labeled icon button" data-action="setCurrentPlace">
            <i class="marker icon"></i>
            J'y {{#if currentPlace}}suis{{else}}vais{{/if}}
          </button>
        </div>
        <div class="height wide column">
          <a class="ui blue labeled icon button disabled" href="{{pathFor 'promotions' placeId=_id}}">
            <i class="star icon"></i>
            Mes promos
          </a>
        </div>
      </div>
      <br>
      <div class="ui three tiny statistics">
        <div class="ui statistic">
          <div class="value">
            {{or customers.length 0}}
          </div>
          <div class="label">
            Client{{#if greaterThan customers.length 1}}s{{/if}}
          </div>
        </div>
        <div class="ui statistic">
          <div class="value">
            {{voucherCount}}
          </div>
          <div class="label">
            Avoir{{#if greaterThan voucherCount 1}}s{{/if}}
          </div>
        </div>
        <div class="ui statistic">
          <div class="value">
            {{loyaltyCardCount}}
          </div>
          <div class="label">
            Carte{{#if greaterThan loyaltyCardCount 1}}s{{/if}}
          </div>
        </div>
      </div>
    </div>
    <hr>
    {{/if}}
    <div class="ui basic segment">
      <h1 class="ui center aligned header">
        {{name}}
        <div class="sub header">{{description}}</div>
      </h1>
      {{> image imageId=imageId classNames='ui centered medium rounded image'}}
      <div class="ui list">
        {{#each addresses}}
          <div class="item">
            <i class="map marker icon"></i>
            <div class="content">
              <a class="header placeMap">{{street}}</a>
              <div class="description">{{zip}} {{city}}</div>
            </div>
          </div>
          {{#if phone}}
          <div class="item">
            <i class="phone icon"></i>
            <div class="content">
              <a class="header" href="tel:{{phone}}">{{phone}}</a>
            </div>
          </div>
          {{/if}}
        {{/each}}
      </div>
      <div class="ui relaxed divided items">
      {{#if myLoyaltyCard}}
        <div class="item">
          <div class="content">
            <button type="button" class="teal right floated ui circular icon button" id="loyaltyCardHelp" data-position="top right"><i class="help icon"></i></button>
            <div class="ui special popup">
              Chaque tranche d'achat de {{{formatMoney loyaltyCard.pointCost}}} ajoute 1 point à la carte de fidélité.
              <br><br>
              Quand votre carte atteint {{loyaltyCard.size}} points, vous recevez automatiquement un avoir de {{{formatMoney loyaltyCard.voucherValue}}} et le compte de points est remis a zéro.
            </div>
            <a class="header" data-action="loyaltyCardHistory"><i class=" yellow star icon"></i> {{myLoyaltyCard.points}} / {{myLoyaltyCard.size}} points sur votre carte</a>
            <div class="meta" data-action="loyaltyCardHistory">
              &nbsp;<i class="grey history icon"></i> Mise à jour {{#if myLoyaltyCard.updatedAt}}{{fromNow myLoyaltyCard.updatedAt}}{{else}}{{fromNow myLoyaltyCard.createdAt}}{{/if}}
            </div>

          </div>
        </div>
      {{/if}}
      {{#if myVoucher}}
        <div class="item" data-action="voucherHistory">
          <div class="content">
            <a class="header"><i class=" blue ticket icon"></i> {{{formatMoney myVoucher.value}}} d'avoir ici</a>
            <div class="meta">
              &nbsp;<i class="grey history icon"></i> Mis à jour {{#if myVoucher.updatedAt}}{{fromNow myVoucher.updatedAt}}{{else}}{{fromNow myVoucher.createdAt}}{{/if}}
            </div>
          </div>
        </div>
      {{/if}}
      </div>
    </div>
    {{/with}}

  {{> histories}}
</template>
